import { Component, OnInit } from '@angular/core';
import { LoginModel } from 'src/app/models/login-model';
import { AuthenticationService } from 'src/app/services/authentication.service';
import { TokenStorageService } from 'src/app/services/token-storage.service';

@Component({
 selector: 'app-login-page',
 templateUrl: './login-page.component.html',
 styleUrls: ['./login-page.component.css'],
})
export class LoginPageComponent implements OnInit {
 //------variables----------------------
 isLoggedIn = false;
 isLoginFailed = false;
 errorMessage = '';
 roles: string[] = [];
 loginModel : LoginModel = new LoginModel('','');
 //---------DI-------------------
 constructor(
 private authService: AuthenticationService,
 private tokenStorage: TokenStorageService) {}
 //---------OnInit-------------------
 ngOnInit(): void {
 if (this.tokenStorage.getToken()) {
 this.isLoggedIn = true;
 this.roles = this.tokenStorage.getUser().roles;

 }
 }
 onSubmit(): void {
 this.authService.loginUser(this.loginModel).subscribe(
 data => {
 this.tokenStorage.saveToken(data.token);
 this.tokenStorage.saveUser(data);
 this.isLoginFailed = false;
 this.isLoggedIn = true;
 this.roles = this.tokenStorage.getUser().roles;
//  this.reloadPage();
 },
 err => {
 this.errorMessage = err.error.message;
 this.isLoginFailed = true;
 }
 );
 }
//  reloadPage(): void {
//  window.location.reload();
//  }
}

